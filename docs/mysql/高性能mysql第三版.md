#第三章诊断间歇性问题，比如系统偶尔停顿或者慢查询。很难诊断。有些是数据库的有些也不是。只有在问题发生的地方通过观察资源的使用情况。下面是是一些诊断间歇性问题的方法和工具。

# 1.单条查询问题还是服务器问题
#使用Show global status
以比较高的频率比如每秒执行一次 Show global status 命令捕获数据。
问题出现时，则可以通过某些计数器 比如 Threads_running、Threads_connected、Questions和Queries 的尖刺或者凹陷来发现。

#使用Show Processlist(进程列表),不停的捕获 SHow processList的输出，来观察是否有大量的线程处于不正常的状态或者有其他不正常的特征。例如 “statistics” 状态
。另外也少会见到 “未经验证的用户 Unauthenticated user”
SHOW PROCESSLIST 是 MySQL 提供的一个命令，用于显示当前正在运行的线程（包括客户端连接和后台线程）的信息。它能够展示每个线程的状态、执行时间、正在执行的 SQL 语句等信息。
产生原因：

监控数据库活动：通过查看当前线程列表，可以监控数据库服务器上正在执行的操作，包括查询、连接和后台任务等。
诊断慢查询：可以用于识别正在执行的长时间运行的查询，从而进行性能分析和优化。
检查占用资源的连接：帮助识别占用大量资源的连接，如 CPU、内存或磁盘 I/O。
能解决的问题：

识别性能瓶颈：通过查看执行时间较长的查询，可以发现可能的性能瓶颈，并进行相应优化。
监控连接情况：可以了解数据库中当前活跃的连接数，帮助监控数据库负载情况。
排查死锁：检查是否有线程在等待锁资源或者发生了死锁情况。
总之，SHOW PROCESSLIST 命令可以帮助 DBA 和开发人员实时监控数据库服务器的运行情况，诊断性能问题，以及及时发现可能的数据库连接或查询方面的问题。

#使用查询日志，开启慢查询日志，并在全局级别设置 long_query_time 为0，并且确认所有连接都采用了新的设置。
确定是否是因为 之前某个时间段的查询高峰 阻塞了后面的查询

#收集数据
系统状态、cpu利用率、磁盘使用率和可用空间、ps的输出采样、内存利用率。
当一个问题发生时一般来说有两种可能：服务器需要大量的工作，从而导致大量消耗Cpu; 或者在等待某些资源被释放。


#Show status

SHOW STATUS 是一个 MySQL 命令，用于显示各种服务器状态变量的当前值。通过这个命令，可以获取有关服务器性能和运行状况的详细信息。

这个命令返回了一系列的键值对，每个键代表一个状态变量，而对应的值则表示该状态变量的当前值。这些状态变量包括了诸如连接数、缓存命中率、线程运行状态等等。

使用 SHOW STATUS 命令能够帮助管理员和开发人员监控服务器的运行状况，进行性能调优，并且解决其中可能出现的问题。比如，可以通过这些信息来监控数据库服务器的负载情况、查询缓存的效率、连接数的使用情况等。

#第四章Schema与数据类型优化
#尽量避免NUll,通常情况下最好指定列为Not Null,除非诊的需要存储null值。如果查询中包含可以为Null的列,对Mysql来说更难优化,因为可以为Null的列使得索引、索引统计和值比较都更为复杂。
可为Null的列会使用更多的存储空间。当可为Null的列被索引时，每个索引记录需要一个额外的字节。
#时间类型
DateTime和TimeSamp列都可以存储相同类型的数据:时间和日期,精确到秒。然而Timestamp只使用DateTime一半的存储空间,并且会根据时区变化。具有特殊的自动更新能力。
需要注意的是，TIMESTAMP类型的精度为秒级，而不是毫秒级或微秒级。如果需要更高精度的时间戳，可以考虑使用DATETIME或者BIGINT类型
MySQL 5.6及以上版本支持将TIMESTAMP列的范围扩展至'1970-01-01 00:00:00'至'9999-12-31 23:59:59.999999'，并且可以通过配置文件进行调整。
#浮点类型在存储同样范围的值时,通常比Decimal使用更少的空间。Float使用4个字节存储,Double占用8个字节，相比Float有更高的精度和更大的范围。
因为需要额外的空间和计算开销,所以进来只在对小数进行精确计算时才使用Decimal.但在数据量比较大的时候,可以考虑使用Bigint 代替Decimal.
避免decimal精确计算代价高的问题。